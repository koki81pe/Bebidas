// ============================================
// SOLID CODE - BEBIDAS
// Generado: 24/12/2025, 9:02:20 a. m.
// Total de archivos: 7
// ============================================



// ============================================
// ARCHIVO 1/7: code.gs
// URL: https://raw.githubusercontent.com/koki81pe/Bebidas/refs/heads/main/code.gs
// ============================================

/*
***********************************************
Bebidas a Pedido - code.gs - V1.07-SV02
23/12/2024 - 17:35
***********************************************
*/

// ***********************************************
// 01. Configuraci√≥n Global - code.gs - V1.01-SV01
// ***********************************************

const SHEET_ID = '1i2sy3pov9zI3pBJiwGJl070nDmFd_zwfq9Oxv3Gw5MI';
const SHEET_LICORES = 'Licores';
const SHEET_PEDIDOS = 'Pedidos';
const SHEET_ADMIN = 'admin';

// ***********************************************
// 02. Funci√≥n Principal - code.gs - V1.01-SV01
// ***********************************************

function doGet() {
  return HtmlService.createTemplateFromFile('home')
    .evaluate()
    .setTitle('Bebidas a Pedido')
    .setFaviconUrl('https://img.icons8.com/color/48/000000/whiskey.png')
    .addMetaTag('viewport', 'width=device-width, initial-scale=1.0');
}

// ***********************************************
// 03. Incluir Archivos HTML - code.gs - V1.01-SV01
// ***********************************************

function include(filename) {
  return HtmlService.createHtmlOutputFromFile(filename).getContent();
}

// ***********************************************
// 04. Obtener Lista de Licores - code.gs - V1.02-SV01
// ***********************************************

function getLicores() {
  try {
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sheet = ss.getSheetByName(SHEET_LICORES);
    
    if (!sheet) {
      console.error('No se encontr√≥ la hoja: ' + SHEET_LICORES);
      return { success: false, message: 'No se encontr√≥ la hoja de Licores' };
    }
    
    const data = sheet.getDataRange().getValues();
    const headers = data[0];
    const rows = data.slice(1);
    
    // Filtrar filas vac√≠as y productos sin stock
    const licores = rows
      .filter(row => row[1]) // Filtrar por columna Producto (√≠ndice 1)
      .map(row => {
        // Calcular SaldoFinal: Saldo Inicial (F) - CantVendida (I)
        const saldoInicial = parseFloat(row[5]) || 0;  // Columna F (√≠ndice 5)
        const cantVendida = parseFloat(row[8]) || 0;   // Columna I (√≠ndice 8)
        const saldoFinal = saldoInicial - cantVendida;
        
        return {
          code: row[0] || '',
          producto: row[1] || '',
          empaque: row[2] || '',
          size: row[3] || '',
          sugerido: row[4] || 0,
          saldoInicial: Math.max(0, saldoFinal),  // Stock disponible real
          precio: row[6] || 0
        };
      })
      .filter(licor => licor.saldoInicial > 0); // Solo productos con stock disponible
    
    console.log('Licores obtenidos: ' + licores.length + ' (con stock disponible)');
    return { success: true, data: licores };
    
  } catch (error) {
    console.error('Error en getLicores: ' + error.toString());
    return { success: false, message: 'Error al obtener licores: ' + error.toString() };
  }
}

// ***********************************************
// 05. Guardar Pedido - code.gs - V1.03-SV01
// ***********************************************

function guardarPedido(cliente, telefono, productos) {
  try {
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sheetPedidos = ss.getSheetByName(SHEET_PEDIDOS);
    const sheetLicores = ss.getSheetByName(SHEET_LICORES);
    
    if (!sheetPedidos || !sheetLicores) {
      console.error('No se encontraron las hojas necesarias');
      return { success: false, message: 'Error de configuraci√≥n de hojas' };
    }
    
    // Generar ID de pedido
    const pedidoId = generarIdPedido();
    const fecha = Utilities.formatDate(new Date(), 'America/Lima', 'dd/MM/yyyy HH:mm:ss');
    
    // Preparar datos para insertar en Pedidos
    const rows = productos.map(prod => [
      cliente,           // A: Cliente
      telefono,          // B: Fono
      prod.code,         // C: Code
      prod.producto,     // D: Producto
      prod.empaque,      // E: Empaque
      prod.size,         // F: Size
      prod.precio,       // G: Precio
      Number(prod.cantidad),  // H: Cantidad (forzar como n√∫mero)
      fecha,             // I: Fecha
      pedidoId,          // J: Pedido
      'Pendiente'        // K: Estado
    ]);
    
    // Insertar todas las filas del pedido
    if (rows.length > 0) {
      sheetPedidos.getRange(sheetPedidos.getLastRow() + 1, 1, rows.length, 11).setValues(rows);
    }
    
    // Actualizar CantReq (Col H) en hoja Licores
    const dataLicores = sheetLicores.getDataRange().getValues();
    productos.forEach(prod => {
      for (let i = 1; i < dataLicores.length; i++) {
        if (dataLicores[i][0] === prod.code) { // Columna A: Code
          const filaLicor = i + 1;
          const cantReqActual = parseInt(dataLicores[i][7]) || 0; // Columna H: CantReq (√≠ndice 7)
          const nuevaCantReq = cantReqActual + prod.cantidad;
          sheetLicores.getRange(filaLicor, 8).setValue(nuevaCantReq); // Actualizar Col H
          console.log(`Actualizado ${prod.code}: CantReq = ${nuevaCantReq} (+${prod.cantidad})`);
          break;
        }
      }
    });
    
    console.log('Pedido guardado: ' + pedidoId + ' - Cliente: ' + cliente + ' - Tel: ' + telefono + ' - Productos: ' + productos.length);
    
    return { 
      success: true, 
      message: 'Pedido registrado exitosamente',
      pedidoId: pedidoId
    };
    
  } catch (error) {
    console.error('Error en guardarPedido: ' + error.toString());
    return { success: false, message: 'Error al guardar pedido: ' + error.toString() };
  }
}

// ***********************************************
// 06. Generar ID de Pedido - code.gs - V1.02-SV01
// ***********************************************

function generarIdPedido() {
  try {
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sheet = ss.getSheetByName(SHEET_PEDIDOS);
    
    // Obtener fecha actual en formato YYYYMMDD
    const fecha = Utilities.formatDate(new Date(), 'America/Lima', 'yyyyMMdd');
    
    // Buscar el √∫ltimo pedido del d√≠a
    const data = sheet.getDataRange().getValues();
    const pedidosHoy = data
      .slice(1) // Saltar encabezados
      .map(row => row[9]) // Columna J: Pedido (√≠ndice 9)
      .filter(pedido => pedido && pedido.toString().includes('PED-' + fecha));
    
    // Calcular el siguiente n√∫mero
    let numero = 1;
    if (pedidosHoy.length > 0) {
      const numeros = pedidosHoy.map(pedido => {
        const partes = pedido.toString().split('-');
        return parseInt(partes[2]) || 0;
      });
      numero = Math.max(...numeros) + 1;
    }
    
    // Formatear con ceros a la izquierda (3 d√≠gitos)
    const numeroFormateado = numero.toString().padStart(3, '0');
    
    const pedidoId = `PED-${fecha}-${numeroFormateado}`;
    console.log('ID generado: ' + pedidoId);
    
    return pedidoId;
    
  } catch (error) {
    console.error('Error en generarIdPedido: ' + error.toString());
    // En caso de error, generar un ID b√°sico con timestamp
    const timestamp = new Date().getTime();
    return `PED-${timestamp}`;
  }
}

// ***********************************************
// 07. Verificar Acceso Admin - code.gs - V1.01-SV01
// ***********************************************

function verificarAcceso(usuario) {
  try {
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sheet = ss.getSheetByName(SHEET_ADMIN);
    
    if (!sheet) {
      console.error('No se encontr√≥ la hoja: ' + SHEET_ADMIN);
      return { success: false, message: 'Error de configuraci√≥n' };
    }
    
    const data = sheet.getDataRange().getValues();
    const usuarios = data.slice(1).map(row => row[0].toString().toLowerCase());
    
    const usuarioIngresado = usuario.toString().toLowerCase().trim();
    const encontrado = usuarios.includes(usuarioIngresado);
    
    console.log('Verificaci√≥n de acceso - Usuario: ' + usuario + ' - Resultado: ' + encontrado);
    
    return { 
      success: encontrado,
      message: encontrado ? 'Acceso concedido' : 'Usuario no autorizado'
    };
    
  } catch (error) {
    console.error('Error en verificarAcceso: ' + error.toString());
    return { success: false, message: 'Error al verificar acceso' };
  }
}

// ***********************************************
// 08. Obtener Pedidos - code.gs - V1.02-SV01
// ***********************************************

function getPedidos() {
  try {
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sheet = ss.getSheetByName(SHEET_PEDIDOS);
    
    if (!sheet) {
      console.error('No se encontr√≥ la hoja: ' + SHEET_PEDIDOS);
      return { success: false, message: 'No se encontr√≥ la hoja de Pedidos' };
    }
    
    const data = sheet.getDataRange().getValues();
    const rows = data.slice(1); // Saltar encabezados
    
    console.log('Total de filas en Pedidos: ' + rows.length);
    
    // Filtrar filas vac√≠as y mapear datos
    const pedidos = rows
      .filter(row => row[9]) // Filtrar por columna J: Pedido (√≠ndice 9)
      .map(row => {
        // Formatear fecha - aceptar cualquier formato
        let fechaFormateada = '';
        try {
          if (row[8]) { // Columna I: Fecha
            if (row[8] instanceof Date) {
              fechaFormateada = Utilities.formatDate(row[8], 'America/Lima', 'dd/MM/yyyy HH:mm');
            } else {
              fechaFormateada = row[8].toString();
            }
          }
        } catch (e) {
          fechaFormateada = row[8] ? row[8].toString() : '';
        }
        
        return {
          cliente: row[0] || '',      // A: Cliente
          telefono: row[1] || '',     // B: Fono
          code: row[2] || '',         // C: Code
          producto: row[3] || '',     // D: Producto
          empaque: row[4] || '',      // E: Empaque
          size: row[5] || '',         // F: Size
          precio: parseFloat(row[6]) || 0,  // G: Precio
          cantidad: parseInt(row[7]) || 1,  // H: Cantidad
          fecha: fechaFormateada,     // I: Fecha
          pedidoId: row[9] || '',     // J: Pedido
          estado: row[10] || 'Pendiente'  // K: Estado
        };
      });
    
    console.log('Pedidos filtrados: ' + pedidos.length);
    
    // Agrupar por pedidoId
    const pedidosAgrupados = {};
    pedidos.forEach(item => {
      if (!pedidosAgrupados[item.pedidoId]) {
        pedidosAgrupados[item.pedidoId] = {
          pedidoId: item.pedidoId,
          cliente: item.cliente,
          telefono: item.telefono,
          fecha: item.fecha,
          estado: item.estado,
          productos: [],
          total: 0
        };
      }
      
      pedidosAgrupados[item.pedidoId].productos.push({
        code: item.code,
        producto: item.producto,
        empaque: item.empaque,
        size: item.size,
        precio: item.precio,
        cantidad: item.cantidad
      });
      
      pedidosAgrupados[item.pedidoId].total += item.precio * item.cantidad;
    });
    
    // Convertir a array y ordenar por pedidoId (m√°s antiguos primero)
    const pedidosArray = Object.values(pedidosAgrupados).sort((a, b) => {
      return a.pedidoId.localeCompare(b.pedidoId);
    });
    
    console.log('Pedidos agrupados: ' + pedidosArray.length);
    return { success: true, data: pedidosArray };
    
  } catch (error) {
    console.error('Error en getPedidos: ' + error.toString());
    console.error('Stack trace: ' + error.stack);
    return { success: false, message: 'Error al obtener pedidos: ' + error.toString() };
  }
}

// ***********************************************
// 09. Marcar Pedido como Pagado - code.gs - V1.03-SV01
// ***********************************************

function marcarPagado(pedidoId) {
  try {
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sheetPedidos = ss.getSheetByName(SHEET_PEDIDOS);
    const sheetLicores = ss.getSheetByName(SHEET_LICORES);
    
    if (!sheetPedidos || !sheetLicores) {
      console.error('No se encontraron las hojas necesarias');
      return { success: false, message: 'Error de configuraci√≥n de hojas' };
    }
    
    const dataPedidos = sheetPedidos.getDataRange().getValues();
    const dataLicores = sheetLicores.getDataRange().getValues();
    
    // Buscar todas las filas del pedido
    const filasPedido = [];
    for (let i = 1; i < dataPedidos.length; i++) {
      if (dataPedidos[i][9] === pedidoId) { // Columna J: Pedido
        filasPedido.push({
          fila: i + 1,
          code: dataPedidos[i][2],      // C: Code
          cantidad: parseInt(dataPedidos[i][7]) || 1  // H: Cantidad
        });
      }
    }
    
    if (filasPedido.length === 0) {
      return { success: false, message: 'No se encontr√≥ el pedido' };
    }
    
    // Actualizar estado a "Pagado" en hoja Pedidos
    filasPedido.forEach(item => {
      sheetPedidos.getRange(item.fila, 11).setValue('Pagado'); // Columna K: Estado
    });
    
    // Actualizar CantReq (Col H) y CantVendida (Col I) en hoja Licores
    filasPedido.forEach(pedidoItem => {
      for (let i = 1; i < dataLicores.length; i++) {
        if (dataLicores[i][0] === pedidoItem.code) { // Columna A: Code
          const filaLicor = i + 1;
          
          // Restar de CantReq (Col H)
          const cantReqActual = parseInt(dataLicores[i][7]) || 0; // Columna H: CantReq (√≠ndice 7)
          const nuevaCantReq = Math.max(0, cantReqActual - pedidoItem.cantidad); // No permitir negativos
          sheetLicores.getRange(filaLicor, 8).setValue(nuevaCantReq);
          
          // Sumar a CantVendida (Col I)
          const cantVendidaActual = parseInt(dataLicores[i][8]) || 0; // Columna I: CantVendida (√≠ndice 8)
          const nuevaCantVendida = cantVendidaActual + pedidoItem.cantidad;
          sheetLicores.getRange(filaLicor, 9).setValue(nuevaCantVendida);
          
          console.log(`Actualizado ${pedidoItem.code}: CantReq=${nuevaCantReq} (-${pedidoItem.cantidad}), CantVendida=${nuevaCantVendida} (+${pedidoItem.cantidad})`);
          break;
        }
      }
    });
    
    console.log('Pedido ' + pedidoId + ' marcado como Pagado - ' + filasPedido.length + ' productos actualizados');
    
    return {
      success: true,
      message: 'Pedido marcado como Pagado',
      productosActualizados: filasPedido.length
    };
    
  } catch (error) {
    console.error('Error en marcarPagado: ' + error.toString());
    console.error('Stack trace: ' + error.stack);
    return { success: false, message: 'Error al marcar pedido: ' + error.toString() };
  }
}

// ***********************************************
// 10. Funci√≥n de Diagn√≥stico - code.gs - V1.06-SV01
// ***********************************************

function diagnosticar() {
  console.log('='.repeat(60));
  console.log('DIAGN√ìSTICO - BEBIDAS A PEDIDO V1.06');
  console.log('='.repeat(60));
  
  try {
    // Test 1: Conexi√≥n al Sheet
    console.log('\n1. Probando conexi√≥n al Sheet...');
    const ss = SpreadsheetApp.openById(SHEET_ID);
    console.log('‚úì Conectado a: ' + ss.getName());
    
    // Test 2: Hojas disponibles
    console.log('\n2. Verificando hojas...');
    const sheets = ss.getSheets();
    sheets.forEach(sheet => {
      console.log('  - ' + sheet.getName());
    });
    
    // Test 3: Lectura de Licores
    console.log('\n3. Leyendo licores...');
    const resultado = getLicores();
    console.log('  Success: ' + resultado.success);
    if (resultado.success) {
      console.log('  Productos encontrados: ' + resultado.data.length);
      if (resultado.data.length > 0) {
        console.log('  Ejemplo: ' + JSON.stringify(resultado.data[0]));
      }
    } else {
      console.log('  Error: ' + resultado.message);
    }
    
    console.log('\n' + '='.repeat(60));
    console.log('DIAGN√ìSTICO COMPLETO');
    console.log('='.repeat(60));
    
    return { success: true, message: 'Diagn√≥stico completado' };
    
  } catch (error) {
    console.error('\n‚úó ERROR EN DIAGN√ìSTICO:');
    console.error(error.toString());
    console.error(error.stack);
    return { success: false, message: error.toString() };
  }
}


// ============================================
// ARCHIVO 2/7: home.html
// URL: https://raw.githubusercontent.com/koki81pe/Bebidas/refs/heads/main/home.html
// ============================================

<!DOCTYPE html>
<html lang="es">
<head>
  <!--
  ***********************************************
  Bebidas a Pedido - home.html - V1.11
  24/12/2025 - 07:25
  ***********************************************
  -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bebidas a Pedido</title>
  <?!= include('style'); ?>
</head>
<body>

  <!-- ***********************************************
       01. Header Principal - home.html - V1.02-SV01
       *********************************************** -->
  <header class="main-header">
    <div class="header-content">
      <div class="logo-section">
        <span class="logo-icon">ü•É</span>
        <h1 class="app-title">Bebidas a Pedido</h1>
      </div>
      <button id="btnAdmin" class="btn-admin" title="Acceso Administrador">
        <span class="admin-icon">üë§</span>
      </button>
    </div>
  </header>

  <!-- ***********************************************
       02. Contenedor Principal - home.html - V1.02-SV01
       *********************************************** -->
  <main class="main-container" id="mainContainer">
    
    <!-- Vista de Productos (Default) -->
    <div id="vistaProductos" class="vista-productos">
      
      <!-- Mensaje de Invitaci√≥n -->
      <p class="texto-instruccion">Haz clic en los productos</p>
      
      <!-- Loader -->
      <div id="loader" class="loader-container">
        <div class="loader"></div>
        <p>Cargando productos...</p>
      </div>

      <!-- Lista de Productos -->
      <div id="listaProductos" class="productos-grid" style="display: none;">
        <!-- Se llena din√°micamente -->
      </div>

      <!-- Footer con Total y Bot√≥n -->
      <div id="footerPedido" class="footer-pedido" style="display: none;">
        <div class="total-section">
          <span class="total-label">Total:</span>
          <span class="total-amount" id="totalAmount">S/ 0.00</span>
        </div>
        <button id="btnHacerPedido" class="btn-primary" disabled>
          Hacer Pedido
        </button>
      </div>
    </div>

    <!-- Vista de Pedidos (Admin) -->
    <div id="vistaPedidos" class="vista-pedidos" style="display: none;">
      <?!= include('pedidos'); ?>
    </div>

  </main>

  <!-- ***********************************************
       03. Modal Login Admin - home.html - V1.02-SV01
       *********************************************** -->
  <div id="modalLogin" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 class="modal-title">Acceso Administrador</h2>
        <button class="modal-close" onclick="cerrarModalLogin()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="inputUsuario">C√≥digo de Acceso</label>
          <input 
            type="password" 
            id="inputUsuario" 
            class="form-input" 
            placeholder="Ingresa tu c√≥digo"
            autocomplete="off">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="cerrarModalLogin()">Cancelar</button>
        <button class="btn-primary" onclick="verificarAcceso()">Acceder</button>
      </div>
    </div>
  </div>

  <!-- ***********************************************
       04. Modal Nombre y Tel√©fono Cliente - home.html - V1.02-SV01
       *********************************************** -->
  <div id="modalCliente" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 class="modal-title">Confirmar Pedido</h2>
        <button class="modal-close" onclick="cerrarModalCliente()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="inputCliente">Tu Nombre</label>
          <input 
            type="text" 
            id="inputCliente" 
            class="form-input" 
            placeholder="Ingresa tu nombre"
            autocomplete="name">
        </div>
        <div class="form-group">
          <label for="inputTelefono">Tu Tel√©fono / WhatsApp</label>
          <input 
            type="tel" 
            id="inputTelefono" 
            class="form-input" 
            placeholder="Ej: 997888530"
            autocomplete="tel">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="cerrarModalCliente()">Cancelar</button>
        <button class="btn-primary" onclick="confirmarPedido()">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- ***********************************************
       05. Modal Pedido Generado - home.html - V1.02-SV01
       *********************************************** -->
  <div id="modalPedidoGenerado" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">‚úì Pedido Registrado</h2>
        <button class="modal-close" onclick="cerrarModalPedidoGenerado()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="pedido-info">
          <p class="pedido-id"><strong>Pedido:</strong> <span id="pedidoIdGenerado"></span></p>
          <p class="pedido-cliente"><strong>Cliente:</strong> <span id="pedidoClienteNombre"></span></p>
        </div>
        
        <div class="whatsapp-section">
          <label class="whatsapp-label">Copia este mensaje y env√≠alo a WhatsApp: <strong>997 888 530</strong></label>
          <textarea 
            id="textoWhatsapp" 
            class="whatsapp-textarea" 
            readonly></textarea>
          <button class="btn-copy" onclick="copiarTexto()">
            <span class="copy-icon">üìã</span> Copiar Mensaje
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-primary" onclick="cerrarModalPedidoGenerado()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- ***********************************************
       06. Modal Imagen de Producto - home.html - V1.08-SV01
       *********************************************** -->
  <div id="modalImagen" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="cerrarModalImagen()"></div>
    <div class="modal-content modal-imagen">
      <div class="modal-header">
        <h2 class="modal-title" id="modalImagenTitulo">Producto</h2>
        <button class="modal-close" onclick="cerrarModalImagen()">√ó</button>
      </div>
      <div class="modal-body modal-imagen-body">
        <img id="modalImagenSrc" src="" alt="Producto" class="imagen-producto-modal">
      </div>
    </div>
  </div>

  <!-- Incluir Modals y Scripts -->
  <?!= include('modals'); ?>
  <?!= include('scripts'); ?>

</body>
</html>


// ============================================
// ARCHIVO 3/7: modals.html
// URL: https://raw.githubusercontent.com/koki81pe/Bebidas/refs/heads/main/modals.html
// ============================================

<!--
***********************************************
Bebidas a Pedido - modals.html - V1.01
22/12/2024 - 10:50
***********************************************
-->

<!-- ***********************************************
     01. Contenedor de Toast - modals.html - V1.01-SV01
     *********************************************** -->
<div id="toastContainer" class="toast-container"></div>

<style>
/* ***********************************************
   02. Estilos Toast Container - modals.html - V1.01-SV01
   *********************************************** */

.toast-container {
  position: fixed;
  top: 80px;
  right: 20px;
  z-index: 2000;
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-width: 400px;
  width: calc(100% - 40px);
}

/* ***********************************************
   03. Estilos Toast - modals.html - V1.01-SV01
   *********************************************** */

.toast {
  background-color: var(--color-surface);
  border-left: 4px solid;
  border-radius: var(--border-radius-md);
  padding: 16px 20px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: flex-start;
  gap: 12px;
  animation: toastSlideIn 0.3s ease;
  position: relative;
  overflow: hidden;
}

@keyframes toastSlideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes toastSlideOut {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}

.toast.removing {
  animation: toastSlideOut 0.3s ease forwards;
}

/* ***********************************************
   04. Tipos de Toast - modals.html - V1.01-SV01
   *********************************************** */

.toast.success {
  border-left-color: var(--color-success);
}

.toast.error {
  border-left-color: var(--color-error);
}

.toast.warning {
  border-left-color: var(--color-warning);
}

.toast.info {
  border-left-color: var(--color-primary);
}

/* ***********************************************
   05. Contenido Toast - modals.html - V1.01-SV01
   *********************************************** */

.toast-icon {
  font-size: 24px;
  flex-shrink: 0;
  line-height: 1;
}

.toast.success .toast-icon {
  color: var(--color-success);
}

.toast.error .toast-icon {
  color: var(--color-error);
}

.toast.warning .toast-icon {
  color: var(--color-warning);
}

.toast.info .toast-icon {
  color: var(--color-primary);
}

.toast-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.toast-title {
  font-weight: 600;
  font-size: 15px;
  color: var(--color-text);
  line-height: 1.4;
}

.toast-message {
  font-size: 14px;
  color: var(--color-text-muted);
  line-height: 1.4;
}

.toast-close {
  position: absolute;
  top: 8px;
  right: 8px;
  background: none;
  border: none;
  color: var(--color-text-muted);
  cursor: pointer;
  font-size: 20px;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  transition: all 0.2s ease;
  padding: 0;
  line-height: 1;
}

.toast-close:hover {
  background-color: var(--color-accent);
  color: var(--color-text);
}

/* ***********************************************
   06. Barra de Progreso Toast - modals.html - V1.01-SV01
   *********************************************** */

.toast-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background-color: currentColor;
  opacity: 0.5;
  animation: toastProgress linear forwards;
}

.toast.success .toast-progress {
  color: var(--color-success);
}

.toast.error .toast-progress {
  color: var(--color-error);
}

.toast.warning .toast-progress {
  color: var(--color-warning);
}

.toast.info .toast-progress {
  color: var(--color-primary);
}

@keyframes toastProgress {
  from {
    width: 100%;
  }
  to {
    width: 0%;
  }
}

/* ***********************************************
   07. Responsividad Toast - modals.html - V1.01-SV01
   *********************************************** */

@media (max-width: 767px) {
  .toast-container {
    top: auto;
    bottom: 20px;
    right: 10px;
    left: 10px;
    width: calc(100% - 20px);
    max-width: none;
  }
  
  .toast {
    padding: 14px 16px;
  }
  
  .toast-icon {
    font-size: 20px;
  }
  
  .toast-title {
    font-size: 14px;
  }
  
  .toast-message {
    font-size: 13px;
  }
}
</style>

<script>
/* ***********************************************
   08. Sistema de Toast - modals.html - V1.01-SV01
   *********************************************** */

const ToastSystem = {
  container: null,
  defaultDuration: 4000,
  
  init() {
    this.container = document.getElementById('toastContainer');
    if (!this.container) {
      console.error('Toast container no encontrado');
    }
  },
  
  show(type, title, message = '', duration = null) {
    if (!this.container) {
      this.init();
    }
    
    const icons = {
      success: '‚úì',
      error: '‚úó',
      warning: '‚ö†',
      info: '‚Ñπ'
    };
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    const actualDuration = duration || this.defaultDuration;
    
    toast.innerHTML = `
      <span class="toast-icon">${icons[type] || '‚Ñπ'}</span>
      <div class="toast-content">
        <div class="toast-title">${title}</div>
        ${message ? `<div class="toast-message">${message}</div>` : ''}
      </div>
      <button class="toast-close" onclick="ToastSystem.close(this.parentElement)">√ó</button>
      <div class="toast-progress" style="animation-duration: ${actualDuration}ms"></div>
    `;
    
    this.container.appendChild(toast);
    
    // Auto cerrar despu√©s de la duraci√≥n
    setTimeout(() => {
      this.close(toast);
    }, actualDuration);
    
    return toast;
  },
  
  success(title, message = '', duration = null) {
    return this.show('success', title, message, duration);
  },
  
  error(title, message = '', duration = null) {
    return this.show('error', title, message, duration);
  },
  
  warning(title, message = '', duration = null) {
    return this.show('warning', title, message, duration);
  },
  
  info(title, message = '', duration = null) {
    return this.show('info', title, message, duration);
  },
  
  close(toastElement) {
    if (!toastElement || !toastElement.parentElement) return;
    
    toastElement.classList.add('removing');
    
    setTimeout(() => {
      if (toastElement.parentElement) {
        toastElement.parentElement.removeChild(toastElement);
      }
    }, 300);
  },
  
  closeAll() {
    if (!this.container) return;
    
    const toasts = this.container.querySelectorAll('.toast');
    toasts.forEach(toast => this.close(toast));
  }
};

/* ***********************************************
   09. Inicializaci√≥n - modals.html - V1.01-SV01
   *********************************************** */

document.addEventListener('DOMContentLoaded', function() {
  ToastSystem.init();
  console.log('Toast System inicializado');
});

/* ***********************************************
   10. Funciones Helper Globales - modals.html - V1.01-SV01
   *********************************************** */

// Funciones globales para f√°cil acceso
function mostrarExito(titulo, mensaje = '', duracion = null) {
  ToastSystem.success(titulo, mensaje, duracion);
}

function mostrarError(titulo, mensaje = '', duracion = null) {
  ToastSystem.error(titulo, mensaje, duracion);
}

function mostrarAdvertencia(titulo, mensaje = '', duracion = null) {
  ToastSystem.warning(titulo, mensaje, duracion);
}

function mostrarInfo(titulo, mensaje = '', duracion = null) {
  ToastSystem.info(titulo, mensaje, duracion);
}

/* ***********************************************
   11. Manejo de Errores Global - modals.html - V1.01-SV01
   *********************************************** */

function manejarError(error, contexto = '') {
  console.error(`Error ${contexto}:`, error);
  
  let mensaje = 'Ha ocurrido un error inesperado';
  
  if (typeof error === 'string') {
    mensaje = error;
  } else if (error && error.message) {
    mensaje = error.message;
  }
  
  // No mostrar mensajes t√©cnicos largos al usuario
  if (mensaje.length > 150) {
    mensaje = 'Ha ocurrido un error. Por favor, intenta nuevamente.';
  }
  
  ToastSystem.error('Error', mensaje, 5000);
}

/* ***********************************************
   12. Funci√≥n de Confirmaci√≥n - modals.html - V1.01-SV01
   *********************************************** */

function confirmarAccion(titulo, mensaje, onConfirm, onCancel = null) {
  // Esta es una versi√≥n b√°sica usando confirm del navegador
  // Se puede mejorar creando un modal personalizado
  
  const confirmado = confirm(`${titulo}\n\n${mensaje}`);
  
  if (confirmado && onConfirm) {
    onConfirm();
  } else if (!confirmado && onCancel) {
    onCancel();
  }
  
  return confirmado;
}

/* ***********************************************
   13. Loader Global - modals.html - V1.01-SV01
   *********************************************** */

const LoaderGlobal = {
  loader: null,
  
  mostrar(mensaje = 'Cargando...') {
    // Crear loader si no existe
    if (!this.loader) {
      this.loader = document.createElement('div');
      this.loader.id = 'loaderGlobal';
      this.loader.className = 'loader-global';
      this.loader.innerHTML = `
        <div class="loader-global-overlay"></div>
        <div class="loader-global-content">
          <div class="loader"></div>
          <p class="loader-global-text">${mensaje}</p>
        </div>
      `;
      document.body.appendChild(this.loader);
    }
    
    this.loader.style.display = 'flex';
    this.loader.querySelector('.loader-global-text').textContent = mensaje;
  },
  
  ocultar() {
    if (this.loader) {
      this.loader.style.display = 'none';
    }
  }
};

/* ***********************************************
   14. Estilos Loader Global - modals.html - V1.01-SV01
   *********************************************** */
</script>

<style>
.loader-global {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
  display: none;
  align-items: center;
  justify-content: center;
}

.loader-global-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(4px);
}

.loader-global-content {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  z-index: 1;
}

.loader-global-text {
  color: var(--color-text-muted);
  font-size: 16px;
  font-weight: 500;
}
</style>


// ============================================
// ARCHIVO 4/7: pedidos.html
// URL: https://raw.githubusercontent.com/koki81pe/Bebidas/refs/heads/main/pedidos.html
// ============================================

<!--
***********************************************
Bebidas a Pedido - pedidos.html - V1.05
23/12/2024 - 16:00
***********************************************
-->

<!-- ***********************************************
     01. Header Pedidos - pedidos.html - V1.04-SV01
     *********************************************** -->
<div class="pedidos-header">
  <h2>üìã Pedidos Registrados</h2>
  <button class="btn-home" onclick="volverHome()">
    üè† Home
  </button>
</div>

<!-- ***********************************************
     02. Pesta√±as de Filtrado - pedidos.html - V1.04-SV01
     *********************************************** -->
<div class="pedidos-tabs">
  <button class="tab-button active" data-tab="todos" onclick="cambiarTabPedidos('todos')">
    üìä Todos
  </button>
  <button class="tab-button" data-tab="pendientes" onclick="cambiarTabPedidos('pendientes')">
    ‚è≥ Pendientes
  </button>
  <button class="tab-button" data-tab="pagados" onclick="cambiarTabPedidos('pagados')">
    ‚úÖ Pagados
  </button>
</div>

<!-- ***********************************************
     03. Lista de Pedidos - pedidos.html - V1.04-SV01
     *********************************************** -->
<div id="listaPedidos" class="lista-pedidos">
  <!-- Se llena din√°micamente con JavaScript -->
  <div class="loader-container">
    <div class="loader"></div>
    <p>Cargando pedidos...</p>
  </div>
</div>


// ============================================
// ARCHIVO 5/7: scripts.html
// URL: https://raw.githubusercontent.com/koki81pe/Bebidas/refs/heads/main/scripts.html
// ============================================

<script>
/*
***********************************************
Bebidas a Pedido - scripts.html - V1.09
23/12/2024 - 19:00
***********************************************
*/

/* ***********************************************
   01. Variables Globales - scripts.html - V1.09-SV01
   *********************************************** */

let licoresData = [];
let productosSeleccionados = [];
let pedidosData = [];
let vistaActual = 'productos'; // 'productos' o 'pedidos'
let tabActual = 'todos'; // 'todos', 'pendientes' o 'pagados'

// URL base de GitHub para fotos de productos
const FOTOS_BASE_URL = 'https://raw.githubusercontent.com/koki81pe/Bebidas/refs/heads/main/Fotos/';

/* ***********************************************
   02. Inicializaci√≥n - scripts.html - V1.06-SV01
   *********************************************** */

document.addEventListener('DOMContentLoaded', function() {
  console.log('Inicializando Bebidas a Pedido V1.06...');
  cargarLicores();
  configurarEventos();
});

/* ***********************************************
   03. Configurar Eventos - scripts.html - V1.02-SV01
   *********************************************** */

function configurarEventos() {
  // Bot√≥n Admin
  const btnAdmin = document.getElementById('btnAdmin');
  if (btnAdmin) {
    btnAdmin.addEventListener('click', abrirModalLogin);
  }
  
  // Bot√≥n Hacer Pedido
  const btnHacerPedido = document.getElementById('btnHacerPedido');
  if (btnHacerPedido) {
    btnHacerPedido.addEventListener('click', abrirModalCliente);
  }
  
  // Enter en inputs
  const inputUsuario = document.getElementById('inputUsuario');
  if (inputUsuario) {
    inputUsuario.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        verificarAcceso();
      }
    });
  }
  
  const inputCliente = document.getElementById('inputCliente');
  if (inputCliente) {
    inputCliente.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const inputTelefono = document.getElementById('inputTelefono');
        if (inputTelefono) inputTelefono.focus();
      }
    });
  }
  
  const inputTelefono = document.getElementById('inputTelefono');
  if (inputTelefono) {
    inputTelefono.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        confirmarPedido();
      }
    });
  }
  
  console.log('Eventos configurados');
}

/* ***********************************************
   04. Cargar Licores - scripts.html - V1.02-SV01
   *********************************************** */

function cargarLicores() {
  const loader = document.getElementById('loader');
  const listaProductos = document.getElementById('listaProductos');
  
  console.log('Cargando licores desde el servidor...');
  
  google.script.run
    .withSuccessHandler(function(resultado) {
      console.log('Respuesta recibida:', resultado);
      
      if (resultado.success) {
        licoresData = resultado.data;
        console.log(`${licoresData.length} licores cargados`);
        renderizarLicores();
        
        // Ocultar loader, mostrar productos
        if (loader) loader.style.display = 'none';
        if (listaProductos) listaProductos.style.display = 'grid';
        
        mostrarInfo('Listo', `${licoresData.length} productos disponibles`);
      } else {
        throw new Error(resultado.message || 'Error al cargar licores');
      }
    })
    .withFailureHandler(function(error) {
      console.error('Error al cargar licores:', error);
      if (loader) loader.style.display = 'none';
      manejarError(error, 'al cargar productos');
    })
    .getLicores();
}

/* ***********************************************
   05. Renderizar Licores - scripts.html - V1.02-SV01
   *********************************************** */

function renderizarLicores() {
  const listaProductos = document.getElementById('listaProductos');
  if (!listaProductos) {
    console.error('Contenedor de productos no encontrado');
    return;
  }
  
  listaProductos.innerHTML = '';
  
  if (licoresData.length === 0) {
    listaProductos.innerHTML = '<p class="text-center">No hay productos disponibles</p>';
    return;
  }
  
  licoresData.forEach((licor, index) => {
    const card = crearCardProducto(licor, index);
    listaProductos.appendChild(card);
  });
  
  console.log('Licores renderizados');
}

/* ***********************************************
   06. Crear Card de Producto - scripts.html - V1.09-SV01
   *********************************************** */

function crearCardProducto(licor, index) {
  const card = document.createElement('div');
  card.className = 'producto-card';
  card.dataset.index = index;
  
  // Construir URL de foto
  const urlFoto = FOTOS_BASE_URL + licor.code + '.jpg';
  
  card.innerHTML = `
    <div class="producto-selector">‚óã</div>
    <a href="${urlFoto}" target="_blank" class="btn-ver-foto" onclick="event.stopPropagation()">Ver Foto ‚Üó</a>
    <div class="producto-nombre">${licor.producto}</div>
    <div class="producto-detalles">
      <span class="producto-detalle">${licor.empaque}</span>
      <span class="producto-detalle">${licor.size}</span>
    </div>
    <div class="producto-stock">Stock: ${licor.saldoInicial} unidades</div>
    <div class="producto-precio">S/ ${parseFloat(licor.precio).toFixed(2)}</div>
    <div class="producto-cantidad-control" style="display: none;">
      <label>Cantidad:</label>
      <div class="cantidad-input-group">
        <button class="btn-cantidad" onclick="cambiarCantidad(${index}, -1)">‚àí</button>
        <input type="number" class="cantidad-input" id="cantidad_${index}" value="1" min="1" max="${licor.saldoInicial}" readonly>
        <button class="btn-cantidad" onclick="cambiarCantidad(${index}, 1)">+</button>
      </div>
    </div>
  `;
  
  card.addEventListener('click', function(e) {
    // Evitar toggle si se hace clic en los botones de cantidad o link de foto
    if (e.target.classList.contains('btn-cantidad') || 
        e.target.classList.contains('cantidad-input') ||
        e.target.classList.contains('btn-ver-foto')) {
      return;
    }
    toggleProducto(index);
  });
  
  return card;
}

/* ***********************************************
   07. Toggle Producto - scripts.html - V1.02-SV01
   *********************************************** */

function toggleProducto(index) {
  const licor = licoresData[index];
  const card = document.querySelector(`.producto-card[data-index="${index}"]`);
  
  if (!card) return;
  
  const selector = card.querySelector('.producto-selector');
  const cantidadControl = card.querySelector('.producto-cantidad-control');
  const cantidadInput = document.getElementById(`cantidad_${index}`);
  
  // Verificar si ya est√° seleccionado
  const indexSeleccionado = productosSeleccionados.findIndex(p => p.code === licor.code);
  
  if (indexSeleccionado !== -1) {
    // Deseleccionar
    productosSeleccionados.splice(indexSeleccionado, 1);
    card.classList.remove('selected');
    if (selector) selector.textContent = '‚óã';
    if (cantidadControl) cantidadControl.style.display = 'none';
    if (cantidadInput) cantidadInput.value = 1;
  } else {
    // Seleccionar
    const cantidad = cantidadInput ? parseInt(cantidadInput.value) || 1 : 1;
    productosSeleccionados.push({
      code: licor.code,
      producto: licor.producto,
      empaque: licor.empaque,
      size: licor.size,
      precio: parseFloat(licor.precio),
      cantidad: cantidad,
      index: index
    });
    card.classList.add('selected');
    if (selector) selector.textContent = '‚óè';
    if (cantidadControl) cantidadControl.style.display = 'flex';
  }
  
  actualizarTotal();
}

/* ***********************************************
   08. Cambiar Cantidad - scripts.html - V1.02-SV01
   *********************************************** */

function cambiarCantidad(index, cambio) {
  const licor = licoresData[index];
  const cantidadInput = document.getElementById(`cantidad_${index}`);
  
  if (!cantidadInput) return;
  
  let nuevaCantidad = parseInt(cantidadInput.value) + cambio;
  
  // Validar l√≠mites
  const max = licor.saldoInicial;
  if (nuevaCantidad < 1) nuevaCantidad = 1;
  if (nuevaCantidad > max) nuevaCantidad = max;
  
  cantidadInput.value = nuevaCantidad;
  
  // Actualizar en el array de seleccionados
  const productoSeleccionado = productosSeleccionados.find(p => p.code === licor.code);
  if (productoSeleccionado) {
    productoSeleccionado.cantidad = nuevaCantidad;
    actualizarTotal();
  }
}

/* ***********************************************
   09. Actualizar Total - scripts.html - V1.02-SV01
   *********************************************** */

function actualizarTotal() {
  const totalAmount = document.getElementById('totalAmount');
  const btnHacerPedido = document.getElementById('btnHacerPedido');
  const footerPedido = document.getElementById('footerPedido');
  
  const total = productosSeleccionados.reduce((sum, prod) => sum + (prod.precio * prod.cantidad), 0);
  
  if (totalAmount) {
    totalAmount.textContent = `S/ ${total.toFixed(2)}`;
  }
  
  if (btnHacerPedido) {
    if (productosSeleccionados.length > 0) {
      btnHacerPedido.disabled = false;
      if (footerPedido) footerPedido.style.display = 'flex';
    } else {
      btnHacerPedido.disabled = true;
      if (footerPedido) footerPedido.style.display = 'none';
    }
  }
  
  console.log(`Total actualizado: S/ ${total.toFixed(2)} - Productos: ${productosSeleccionados.length}`);
}

/* ***********************************************
   10. Modal Login Admin - scripts.html - V1.02-SV01
   *********************************************** */

function abrirModalLogin() {
  const modal = document.getElementById('modalLogin');
  const input = document.getElementById('inputUsuario');
  
  if (modal) {
    modal.style.display = 'flex';
    if (input) {
      input.value = '';
      setTimeout(() => input.focus(), 100);
    }
  }
}

function cerrarModalLogin() {
  const modal = document.getElementById('modalLogin');
  if (modal) {
    modal.style.display = 'none';
  }
}

function verificarAcceso() {
  const input = document.getElementById('inputUsuario');
  if (!input) return;
  
  const usuario = input.value.trim();
  
  if (!usuario) {
    mostrarAdvertencia('Campo vac√≠o', 'Ingresa tu c√≥digo de acceso');
    return;
  }
  
  LoaderGlobal.mostrar('Verificando...');
  
  google.script.run
    .withSuccessHandler(function(resultado) {
      LoaderGlobal.ocultar();
      
      if (resultado.success) {
        cerrarModalLogin();
        mostrarExito('Acceso concedido', 'Bienvenido');
        mostrarVistaPedidos();
      } else {
        mostrarError('Acceso denegado', 'C√≥digo no v√°lido');
        input.value = '';
        input.focus();
      }
    })
    .withFailureHandler(function(error) {
      LoaderGlobal.ocultar();
      manejarError(error, 'al verificar acceso');
    })
    .verificarAcceso(usuario);
}

/* ***********************************************
   11. Modal Nombre y Tel√©fono Cliente - scripts.html - V1.02-SV01
   *********************************************** */

function abrirModalCliente() {
  if (productosSeleccionados.length === 0) {
    mostrarAdvertencia('Sin productos', 'Selecciona al menos un producto');
    return;
  }
  
  const modal = document.getElementById('modalCliente');
  const inputCliente = document.getElementById('inputCliente');
  const inputTelefono = document.getElementById('inputTelefono');
  
  if (modal) {
    modal.style.display = 'flex';
    if (inputCliente) {
      inputCliente.value = '';
      setTimeout(() => inputCliente.focus(), 100);
    }
    if (inputTelefono) {
      inputTelefono.value = '';
    }
  }
}

function cerrarModalCliente() {
  const modal = document.getElementById('modalCliente');
  if (modal) {
    modal.style.display = 'none';
  }
}

function confirmarPedido() {
  const inputCliente = document.getElementById('inputCliente');
  const inputTelefono = document.getElementById('inputTelefono');
  
  if (!inputCliente || !inputTelefono) return;
  
  const cliente = inputCliente.value.trim();
  const telefono = inputTelefono.value.trim();
  
  if (!cliente) {
    mostrarAdvertencia('Campo vac√≠o', 'Ingresa tu nombre');
    inputCliente.focus();
    return;
  }
  
  if (!telefono) {
    mostrarAdvertencia('Campo vac√≠o', 'Ingresa tu tel√©fono');
    inputTelefono.focus();
    return;
  }
  
  if (productosSeleccionados.length === 0) {
    mostrarAdvertencia('Sin productos', 'Selecciona al menos un producto');
    cerrarModalCliente();
    return;
  }
  
  // Cerrar modal y mostrar loader
  cerrarModalCliente();
  LoaderGlobal.mostrar('Generando pedido...');
  
  console.log('Guardando pedido:', { cliente, telefono, productos: productosSeleccionados });
  
  google.script.run
    .withSuccessHandler(function(resultado) {
      LoaderGlobal.ocultar();
      
      if (resultado.success) {
        console.log('Pedido guardado exitosamente:', resultado.pedidoId);
        mostrarModalPedidoGenerado(cliente, resultado.pedidoId);
        limpiarSeleccion();
      } else {
        throw new Error(resultado.message || 'Error al guardar pedido');
      }
    })
    .withFailureHandler(function(error) {
      LoaderGlobal.ocultar();
      manejarError(error, 'al guardar el pedido');
    })
    .guardarPedido(cliente, telefono, productosSeleccionados);
}

/* ***********************************************
   12. Modal Pedido Generado - scripts.html - V1.02-SV01
   *********************************************** */

function mostrarModalPedidoGenerado(cliente, pedidoId) {
  const modal = document.getElementById('modalPedidoGenerado');
  const pedidoIdElement = document.getElementById('pedidoIdGenerado');
  const pedidoClienteElement = document.getElementById('pedidoClienteNombre');
  const textoWhatsapp = document.getElementById('textoWhatsapp');
  
  if (!modal) return;
  
  // Establecer informaci√≥n
  if (pedidoIdElement) pedidoIdElement.textContent = pedidoId;
  if (pedidoClienteElement) pedidoClienteElement.textContent = cliente;
  
  // Generar texto WhatsApp
  const texto = generarTextoWhatsApp();
  if (textoWhatsapp) textoWhatsapp.value = texto;
  
  // Mostrar modal
  modal.style.display = 'flex';
  
  mostrarExito('¬°Pedido registrado!', `Pedido ${pedidoId} guardado exitosamente`);
}

function cerrarModalPedidoGenerado() {
  const modal = document.getElementById('modalPedidoGenerado');
  if (modal) {
    modal.style.display = 'none';
  }
}

/* ***********************************************
   13. Generar Texto WhatsApp - scripts.html - V1.02-SV01
   *********************************************** */

function generarTextoWhatsApp() {
  let texto = '';
  let total = 0;
  
  productosSeleccionados.forEach(prod => {
    const subtotal = prod.precio * prod.cantidad;
    texto += `- ${prod.producto} ${prod.empaque} ${prod.size} x${prod.cantidad} S/${subtotal.toFixed(2)}\n`;
    total += subtotal;
  });
  
  texto += `*Total: S/${total.toFixed(2)}*`;
  
  return texto;
}

/* ***********************************************
   14. Copiar Texto - scripts.html - V1.02-SV01
   *********************************************** */

function copiarTexto() {
  const textoWhatsapp = document.getElementById('textoWhatsapp');
  
  if (!textoWhatsapp) {
    mostrarError('Error', 'No se encontr√≥ el texto a copiar');
    return;
  }
  
  textoWhatsapp.select();
  textoWhatsapp.setSelectionRange(0, 99999); // Para m√≥viles
  
  try {
    document.execCommand('copy');
    mostrarExito('¬°Copiado!', 'Texto copiado al portapapeles');
  } catch (error) {
    console.error('Error al copiar:', error);
    mostrarError('Error', 'No se pudo copiar el texto');
  }
}

/* ***********************************************
   15. Limpiar Selecci√≥n - scripts.html - V1.02-SV01
   *********************************************** */

function limpiarSeleccion() {
  // Limpiar array
  productosSeleccionados = [];
  
  // Remover clase selected de todas las cards y resetear selectores
  const cards = document.querySelectorAll('.producto-card');
  cards.forEach(card => {
    card.classList.remove('selected');
    const selector = card.querySelector('.producto-selector');
    const cantidadControl = card.querySelector('.producto-cantidad-control');
    if (selector) selector.textContent = '‚óã';
    if (cantidadControl) cantidadControl.style.display = 'none';
  });
  
  // Actualizar total
  actualizarTotal();
  
  console.log('Selecci√≥n limpiada');
}

/* ***********************************************
   16. Vista Pedidos - scripts.html - V1.06-SV01
   *********************************************** */

function mostrarVistaPedidos() {
  const vistaProductos = document.getElementById('vistaProductos');
  const vistaPedidos = document.getElementById('vistaPedidos');
  
  if (vistaProductos) vistaProductos.style.display = 'none';
  if (vistaPedidos) vistaPedidos.style.display = 'block';
  
  vistaActual = 'pedidos';
  tabActual = 'todos'; // Resetear a pesta√±a "Todos" al entrar
  cargarPedidos();
}

function volverHome() {
  const vistaProductos = document.getElementById('vistaProductos');
  const vistaPedidos = document.getElementById('vistaPedidos');
  
  if (vistaProductos) vistaProductos.style.display = 'block';
  if (vistaPedidos) vistaPedidos.style.display = 'none';
  
  vistaActual = 'productos';
  console.log('Volviendo a vista de productos');
}

/* ***********************************************
   17. Cargar Pedidos - scripts.html - V1.02-SV01
   *********************************************** */

function cargarPedidos() {
  const listaPedidos = document.getElementById('listaPedidos');
  
  if (!listaPedidos) {
    console.error('Contenedor de pedidos no encontrado');
    return;
  }
  
  // Mostrar loader
  listaPedidos.innerHTML = `
    <div class="loader-container">
      <div class="loader"></div>
      <p>Cargando pedidos...</p>
    </div>
  `;
  
  console.log('Cargando pedidos desde el servidor...');
  
  google.script.run
    .withSuccessHandler(function(resultado) {
      console.log('Pedidos recibidos:', resultado);
      
      if (resultado.success) {
        pedidosData = resultado.data;
        console.log(`${pedidosData.length} pedidos cargados`);
        renderizarPedidos();
      } else {
        throw new Error(resultado.message || 'Error al cargar pedidos');
      }
    })
    .withFailureHandler(function(error) {
      console.error('Error al cargar pedidos:', error);
      listaPedidos.innerHTML = '<p class="text-center">Error al cargar pedidos</p>';
      manejarError(error, 'al cargar pedidos');
    })
    .getPedidos();
}

/* ***********************************************
   18. Renderizar Pedidos - scripts.html - V1.06-SV01
   *********************************************** */

function renderizarPedidos() {
  const listaPedidos = document.getElementById('listaPedidos');
  
  if (!listaPedidos) {
    console.error('Contenedor de pedidos no encontrado');
    return;
  }
  
  listaPedidos.innerHTML = '';
  
  if (pedidosData.length === 0) {
    listaPedidos.innerHTML = '<p class="text-center">No hay pedidos registrados</p>';
    return;
  }
  
  // Filtrar pedidos seg√∫n la pesta√±a activa
  let pedidosFiltrados = pedidosData;
  
  if (tabActual === 'pendientes') {
    pedidosFiltrados = pedidosData.filter(p => p.estado === 'Pendiente');
  } else if (tabActual === 'pagados') {
    pedidosFiltrados = pedidosData.filter(p => p.estado === 'Pagado');
  }
  
  if (pedidosFiltrados.length === 0) {
    const mensajes = {
      'todos': 'No hay pedidos registrados',
      'pendientes': 'No hay pedidos pendientes',
      'pagados': 'No hay pedidos pagados'
    };
    listaPedidos.innerHTML = `<p class="text-center">${mensajes[tabActual]}</p>`;
    return;
  }
  
  pedidosFiltrados.forEach(pedido => {
    const card = crearCardPedido(pedido);
    listaPedidos.appendChild(card);
  });
  
  console.log(`Pedidos renderizados (${tabActual}): ${pedidosFiltrados.length}`);
}

/* ***********************************************
   19. Crear Card de Pedido - scripts.html - V1.02-SV01
   *********************************************** */

function crearCardPedido(pedido) {
  const card = document.createElement('div');
  card.className = `pedido-item fade-in ${pedido.estado === 'Pagado' ? 'pedido-pagado' : ''}`;
  
  // Badge de estado
  const badgeClase = pedido.estado === 'Pagado' ? 'badge-pagado' : 'badge-pendiente';
  
  // Generar lista de productos
  let productosHTML = '';
  pedido.productos.forEach(prod => {
    productosHTML += `
      <div class="pedido-producto-item">
        <div class="pedido-producto-info">
          <div class="pedido-producto-nombre">${prod.producto} <span class="producto-cantidad-badge">x${prod.cantidad}</span></div>
          <div class="pedido-producto-detalles">${prod.empaque} ‚Ä¢ ${prod.size}</div>
        </div>
        <div class="pedido-producto-precio">S/ ${(parseFloat(prod.precio) * prod.cantidad).toFixed(2)}</div>
      </div>
    `;
  });
  
  // Bot√≥n marcar pagado (solo si est√° Pendiente)
  const botonPagado = pedido.estado === 'Pendiente' ? 
    `<button class="btn-marcar-pagado" onclick="marcarComoPagado('${pedido.pedidoId}')">‚úì Marcar Pagado</button>` : '';
  
  card.innerHTML = `
    <div class="pedido-header-info">
      <div class="pedido-cliente-info">
        <div class="pedido-cliente-nombre">${pedido.cliente}</div>
        <div class="pedido-telefono">üì± ${pedido.telefono}</div>
      </div>
      <div class="pedido-meta">
        <div class="pedido-estado-badge ${badgeClase}">${pedido.estado}</div>
        <div class="pedido-id-badge">${pedido.pedidoId}</div>
        <div class="pedido-fecha">${pedido.fecha}</div>
      </div>
    </div>
    
    <div class="pedido-productos-lista">
      ${productosHTML}
    </div>
    
    <div class="pedido-total-section">
      <span class="pedido-total-label">Total:</span>
      <span class="pedido-total-monto">S/ ${pedido.total.toFixed(2)}</span>
    </div>
    
    ${botonPagado}
  `;
  
  return card;
}

/* ***********************************************
   20. Marcar Como Pagado - scripts.html - V1.06-SV01
   *********************************************** */

function cambiarTabPedidos(tab) {
  // Actualizar variable global
  tabActual = tab;
  
  // Actualizar clases de botones
  const botones = document.querySelectorAll('.tab-button');
  botones.forEach(btn => {
    if (btn.dataset.tab === tab) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
  
  // Re-renderizar lista con el filtro
  renderizarPedidos();
  
  console.log(`Tab cambiada a: ${tab}`);
}

function marcarComoPagado(pedidoId) {
  if (!confirm(`¬øMarcar el pedido ${pedidoId} como PAGADO?\n\nEsto actualizar√° el stock de productos vendidos.`)) {
    return;
  }
  
  LoaderGlobal.mostrar('Marcando como pagado...');
  
  google.script.run
    .withSuccessHandler(function(resultado) {
      LoaderGlobal.ocultar();
      
      if (resultado.success) {
        mostrarExito('‚úì Pedido Pagado', 'El pedido se marc√≥ como pagado y el stock fue actualizado');
        cargarPedidos(); // Recargar lista
      } else {
        throw new Error(resultado.message || 'Error al marcar pagado');
      }
    })
    .withFailureHandler(function(error) {
      LoaderGlobal.ocultar();
      manejarError(error, 'al marcar pedido como pagado');
    })
    .marcarPagado(pedidoId);
}

/* ***********************************************
   21. Cerrar Modals al Click en Overlay - scripts.html - V1.02-SV01
   *********************************************** */

document.addEventListener('click', function(e) {
  if (e.target.classList.contains('modal-overlay')) {
    // Cerrar el modal padre
    const modal = e.target.parentElement;
    if (modal && modal.classList.contains('modal')) {
      modal.style.display = 'none';
    }
  }
});

/* ***********************************************
   22. Log de Estado - scripts.html - V1.09-SV01
   *********************************************** */

console.log('Scripts cargados - Bebidas a Pedido V1.09');
</script>


// ============================================
// ARCHIVO 6/7: style.html
// URL: https://raw.githubusercontent.com/koki81pe/Bebidas/refs/heads/main/style.html
// ============================================

<style>
/*
***********************************************
Bebidas a Pedido - style.html - V1.11
24/12/2025 - 07:25
***********************************************
*/

/* ***********************************************
   01. Reset y Variables - style.html - V1.01-SV01
   *********************************************** */

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  /* Colores Principales */
  --color-primary: #D4AF37;        /* Dorado */
  --color-primary-dark: #B8941F;   /* Dorado oscuro */
  --color-secondary: #1a1a1a;      /* Negro */
  --color-accent: #2c2c2c;         /* Gris oscuro */
  --color-background: #0f0f0f;     /* Negro profundo */
  --color-surface: #1f1f1f;        /* Gris muy oscuro */
  --color-text: #ffffff;           /* Blanco */
  --color-text-muted: #b0b0b0;     /* Gris claro */
  --color-success: #4CAF50;        /* Verde */
  --color-error: #f44336;          /* Rojo */
  --color-warning: #ff9800;        /* Naranja */
  
  /* Espaciado Base */
  --spacing-xs: 0.25rem;   /* 4px */
  --spacing-sm: 0.5rem;    /* 8px */
  --spacing-md: 1rem;      /* 16px */
  --spacing-lg: 1.5rem;    /* 24px */
  --spacing-xl: 2rem;      /* 32px */
  --spacing-xxl: 3rem;     /* 48px */
  
  /* Bordes */
  --border-radius-sm: 4px;
  --border-radius-md: 8px;
  --border-radius-lg: 12px;
  
  /* Sombras */
  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.5);
  
  /* Transiciones */
  --transition-fast: 0.15s ease;
  --transition-normal: 0.3s ease;
}

/* ***********************************************
   02. Estilos Base - style.html - V1.01-SV01
   *********************************************** */

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: var(--color-background);
  color: var(--color-text);
  line-height: 1.6;
  overflow-x: hidden;
}

/* ***********************************************
   03. Header Principal - style.html - V1.01-SV01
   *********************************************** */

.main-header {
  background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-accent) 100%);
  border-bottom: 2px solid var(--color-primary);
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: var(--shadow-md);
}

.header-content {
  max-width: 1400px;
  margin: 0 auto;
  padding: var(--spacing-md) var(--spacing-lg);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo-section {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
}

.logo-icon {
  font-size: 2rem;
  filter: drop-shadow(0 2px 4px rgba(212, 175, 55, 0.3));
}

.app-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--color-primary);
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
}

.btn-admin {
  background-color: var(--color-accent);
  border: 1px solid var(--color-primary);
  color: var(--color-primary);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--border-radius-md);
  cursor: pointer;
  transition: all var(--transition-normal);
  font-size: 1.2rem;
}

.btn-admin:hover {
  background-color: var(--color-primary);
  color: var(--color-secondary);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.admin-icon {
  display: block;
}

/* ***********************************************
   04. Contenedor Principal - style.html - V1.01-SV01
   *********************************************** */

.main-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: var(--spacing-lg);
  min-height: calc(100vh - 80px);
}

/* ***********************************************
   05. Loader - style.html - V1.01-SV01
   *********************************************** */

.loader-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-xxl);
  gap: var(--spacing-md);
}

.loader {
  border: 4px solid var(--color-accent);
  border-top: 4px solid var(--color-primary);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loader-container p {
  color: var(--color-text-muted);
  font-size: 1rem;
}

/* ***********************************************
   06. Grid de Productos - style.html - V1.01-SV01
   *********************************************** */

.productos-grid {
  display: grid;
  gap: var(--spacing-md);
  padding-bottom: 120px; /* Espacio para footer fijo */
}

/* Responsividad Optimizada */
/* M√≥vil: 1 columna */
@media (max-width: 767px) {
  .productos-grid {
    grid-template-columns: 1fr;
    gap: var(--spacing-sm);
  }
  
  .main-container {
    padding: var(--spacing-sm);
  }
}

/* Tablet: 2 columnas */
@media (min-width: 768px) and (max-width: 1023px) {
  .productos-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-md);
  }
}

/* Desktop/Laptop: 3-4 columnas con m√°xima densidad */
@media (min-width: 1024px) {
  .productos-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-sm);
  }
  
  .main-container {
    padding: var(--spacing-md);
  }
}

@media (min-width: 1400px) {
  .productos-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

/* ***********************************************
   07. Card de Producto - style.html - V1.01-SV01
   *********************************************** */

.producto-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-accent);
  border-radius: var(--border-radius-md);
  padding: var(--spacing-md);
  cursor: pointer;
  transition: all var(--transition-normal);
  position: relative;
  overflow: hidden;
}

.producto-card:hover {
  border-color: var(--color-primary);
  box-shadow: var(--shadow-lg);
  transform: translateY(-2px);
}

.producto-card.selected {
  border-color: var(--color-primary);
  background: linear-gradient(135deg, var(--color-surface) 0%, rgba(212, 175, 55, 0.1) 100%);
  box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
}

.producto-card.selected::before {
  content: '‚úì';
  position: absolute;
  top: var(--spacing-sm);
  right: var(--spacing-sm);
  background-color: var(--color-primary);
  color: var(--color-secondary);
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1rem;
  box-shadow: var(--shadow-md);
}

.producto-nombre {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--color-primary);
  margin-bottom: var(--spacing-sm);
  padding-right: 35px; /* Espacio para el check */
}

.producto-detalles {
  display: flex;
  gap: var(--spacing-sm);
  color: var(--color-text-muted);
  font-size: 0.9rem;
  margin-bottom: var(--spacing-sm);
  flex-wrap: wrap;
}

.producto-detalle {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.producto-detalle::before {
  content: '‚Ä¢';
  color: var(--color-primary);
}

.producto-detalle:first-child::before {
  content: '';
}

.producto-precio {
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--color-primary);
  margin-top: var(--spacing-sm);
}

/* Densidad reducida en m√≥vil */
@media (max-width: 767px) {
  .producto-card {
    padding: var(--spacing-md);
  }
}

/* M√°xima densidad en desktop */
@media (min-width: 1024px) {
  .producto-card {
    padding: var(--spacing-sm) var(--spacing-md);
  }
  
  .producto-nombre {
    font-size: 1rem;
  }
  
  .producto-detalles {
    font-size: 0.85rem;
  }
  
  .producto-precio {
    font-size: 1.2rem;
  }
}

/* ***********************************************
   08. Footer de Pedido - style.html - V1.01-SV01
   *********************************************** */

.footer-pedido {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(180deg, transparent 0%, var(--color-secondary) 20%);
  backdrop-filter: blur(10px);
  border-top: 2px solid var(--color-primary);
  padding: var(--spacing-lg);
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--spacing-md);
  z-index: 90;
  box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.5);
}

.total-section {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.total-label {
  color: var(--color-text-muted);
  font-size: 0.9rem;
}

.total-amount {
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--color-primary);
}

/* ***********************************************
   09. Botones - style.html - V1.01-SV01
   *********************************************** */

.btn-primary,
.btn-secondary,
.btn-copy {
  padding: var(--spacing-md) var(--spacing-xl);
  border: none;
  border-radius: var(--border-radius-md);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-normal);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.btn-primary {
  background-color: var(--color-primary);
  color: var(--color-secondary);
  box-shadow: var(--shadow-md);
}

.btn-primary:hover:not(:disabled) {
  background-color: var(--color-primary-dark);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-primary:disabled {
  background-color: var(--color-accent);
  color: var(--color-text-muted);
  cursor: not-allowed;
  opacity: 0.5;
}

.btn-secondary {
  background-color: transparent;
  color: var(--color-text);
  border: 1px solid var(--color-accent);
}

.btn-secondary:hover {
  background-color: var(--color-accent);
  border-color: var(--color-primary);
}

.btn-copy {
  background-color: var(--color-accent);
  color: var(--color-primary);
  border: 1px solid var(--color-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  width: 100%;
  margin-top: var(--spacing-md);
}

.btn-copy:hover {
  background-color: var(--color-primary);
  color: var(--color-secondary);
}

.copy-icon {
  font-size: 1.2rem;
}

/* ***********************************************
   10. Modals - style.html - V1.01-SV01
   *********************************************** */

.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-md);
}

.modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(4px);
}

.modal-content {
  position: relative;
  background-color: var(--color-surface);
  border: 2px solid var(--color-primary);
  border-radius: var(--border-radius-lg);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
  max-width: 600px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  animation: modalSlideIn 0.3s ease;
}

.modal-small {
  max-width: 400px;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-header {
  padding: var(--spacing-lg);
  border-bottom: 1px solid var(--color-accent);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-title {
  font-size: 1.3rem;
  font-weight: 600;
  color: var(--color-primary);
}

.modal-close {
  background: none;
  border: none;
  color: var(--color-text-muted);
  font-size: 2rem;
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all var(--transition-fast);
}

.modal-close:hover {
  background-color: var(--color-accent);
  color: var(--color-primary);
}

.modal-body {
  padding: var(--spacing-lg);
}

.modal-footer {
  padding: var(--spacing-lg);
  border-top: 1px solid var(--color-accent);
  display: flex;
  justify-content: flex-end;
  gap: var(--spacing-md);
}

/* ***********************************************
   11. Formularios - style.html - V1.01-SV01
   *********************************************** */

.form-group {
  margin-bottom: var(--spacing-lg);
}

.form-group label {
  display: block;
  color: var(--color-text-muted);
  font-size: 0.9rem;
  margin-bottom: var(--spacing-sm);
  font-weight: 500;
}

.form-input {
  width: 100%;
  padding: var(--spacing-md);
  background-color: var(--color-background);
  border: 1px solid var(--color-accent);
  border-radius: var(--border-radius-md);
  color: var(--color-text);
  font-size: 1rem;
  transition: all var(--transition-normal);
}

.form-input:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
}

.form-input::placeholder {
  color: var(--color-text-muted);
  opacity: 0.6;
}

/* ***********************************************
   12. Secci√≥n WhatsApp - style.html - V1.01-SV01
   *********************************************** */

.pedido-info {
  background-color: var(--color-background);
  border: 1px solid var(--color-accent);
  border-radius: var(--border-radius-md);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
}

.pedido-info p {
  margin-bottom: var(--spacing-sm);
  color: var(--color-text-muted);
}

.pedido-info p:last-child {
  margin-bottom: 0;
}

.pedido-info strong {
  color: var(--color-primary);
}

.pedido-id,
.pedido-cliente {
  font-size: 0.95rem;
}

.whatsapp-section {
  margin-top: var(--spacing-lg);
}

.whatsapp-label {
  display: block;
  color: var(--color-text-muted);
  font-size: 0.9rem;
  margin-bottom: var(--spacing-sm);
  font-weight: 500;
}

.whatsapp-textarea {
  width: 100%;
  min-height: 200px;
  padding: var(--spacing-md);
  background-color: var(--color-background);
  border: 1px solid var(--color-accent);
  border-radius: var(--border-radius-md);
  color: var(--color-text);
  font-family: 'Courier New', monospace;
  font-size: 0.95rem;
  resize: vertical;
  line-height: 1.6;
}

.whatsapp-textarea:focus {
  outline: none;
  border-color: var(--color-primary);
}

/* ***********************************************
   13. Vista Pedidos Admin - style.html - V1.01-SV01
   *********************************************** */

.pedidos-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-lg);
  padding-bottom: var(--spacing-md);
  border-bottom: 2px solid var(--color-primary);
}

.pedidos-header h2 {
  font-size: 1.5rem;
  color: var(--color-primary);
}

.btn-home {
  background-color: var(--color-accent);
  border: 1px solid var(--color-primary);
  color: var(--color-primary);
  padding: var(--spacing-sm) var(--spacing-lg);
  border-radius: var(--border-radius-md);
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: all var(--transition-normal);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.btn-home:hover {
  background-color: var(--color-primary);
  color: var(--color-secondary);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.pedido-item {
  background-color: var(--color-surface);
  border: 1px solid var(--color-accent);
  border-radius: var(--border-radius-md);
  padding: var(--spacing-lg);
  margin-bottom: var(--spacing-lg);
}

.pedido-header-info {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--spacing-md);
  padding-bottom: var(--spacing-md);
  border-bottom: 1px solid var(--color-accent);
  flex-wrap: wrap;
  gap: var(--spacing-sm);
}

.pedido-cliente-nombre {
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--color-primary);
}

.pedido-meta {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: var(--spacing-xs);
}

.pedido-id-badge {
  background-color: var(--color-accent);
  color: var(--color-primary);
  padding: var(--spacing-xs) var(--spacing-md);
  border-radius: var(--border-radius-sm);
  font-size: 0.85rem;
  font-weight: 600;
}

.pedido-fecha {
  font-size: 0.85rem;
  color: var(--color-text-muted);
}

.pedido-productos-lista {
  margin: var(--spacing-md) 0;
}

.pedido-producto-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-sm) 0;
  border-bottom: 1px dashed var(--color-accent);
}

.pedido-producto-item:last-child {
  border-bottom: none;
}

.pedido-producto-info {
  flex: 1;
}

.pedido-producto-nombre {
  color: var(--color-text);
  font-weight: 500;
  font-size: 0.95rem;
}

.pedido-producto-detalles {
  color: var(--color-text-muted);
  font-size: 0.85rem;
  margin-top: var(--spacing-xs);
}

.pedido-producto-precio {
  color: var(--color-primary);
  font-weight: 600;
  font-size: 1rem;
}

.pedido-total-section {
  margin-top: var(--spacing-md);
  padding-top: var(--spacing-md);
  border-top: 2px solid var(--color-primary);
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: var(--spacing-md);
}

.pedido-total-label {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--color-text);
}

.pedido-total-monto {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-primary);
}

/* ***********************************************
   14. Utilidades - style.html - V1.01-SV01
   *********************************************** */

.text-center {
  text-align: center;
}

.mt-1 { margin-top: var(--spacing-sm); }
.mt-2 { margin-top: var(--spacing-md); }
.mt-3 { margin-top: var(--spacing-lg); }

.mb-1 { margin-bottom: var(--spacing-sm); }
.mb-2 { margin-bottom: var(--spacing-md); }
.mb-3 { margin-bottom: var(--spacing-lg); }

.hidden {
  display: none !important;
}

/* ***********************************************
   15. Scrollbar Personalizada - style.html - V1.01-SV01
   *********************************************** */

::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: var(--color-background);
}

::-webkit-scrollbar-thumb {
  background: var(--color-accent);
  border-radius: var(--border-radius-sm);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-primary);
}

/* ***********************************************
   16. Animaciones de Entrada - style.html - V1.01-SV01
   *********************************************** */

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in {
  animation: fadeIn 0.3s ease;
}

/* ***********************************************
   17. Responsividad Footer - style.html - V1.01-SV01
   *********************************************** */

@media (max-width: 767px) {
  .footer-pedido {
    flex-direction: column;
    align-items: stretch;
  }
  
  .total-section {
    text-align: center;
  }
  
  .btn-primary {
    width: 100%;
  }
  
  .total-amount {
    font-size: 1.5rem;
  }
}

/* ***********************************************
   18. Texto de Instrucci√≥n - style.html - V1.11-SV01
   *********************************************** */

.texto-instruccion {
  text-align: center;
  color: var(--color-primary);
  font-size: 1rem;
  font-weight: 500;
  margin: 0 0 var(--spacing-lg) 0;
  padding: var(--spacing-sm) 0;
}

/* ***********************************************
   18b. Imagen de Producto - style.html - V1.05-SV01
   *********************************************** */

.producto-imagen {
  width: 100%;
  height: 150px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: var(--spacing-md);
  background: linear-gradient(135deg, rgba(212, 175, 55, 0.05) 0%, transparent 100%);
  border-radius: var(--border-radius-md);
  overflow: hidden;
}

.producto-imagen img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  transition: transform var(--transition-normal);
}

.producto-card:hover .producto-imagen img {
  transform: scale(1.05);
}

/* ***********************************************
   19. Selector de Producto (C√≠rculo) - style.html - V1.02-SV01
   *********************************************** */

.producto-selector {
  position: absolute;
  top: var(--spacing-sm);
  right: var(--spacing-sm);
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background-color: var(--color-accent);
  border: 2px solid var(--color-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  color: var(--color-primary);
  transition: all var(--transition-normal);
  z-index: 2;
}

.producto-card.selected .producto-selector {
  background-color: var(--color-primary);
  color: var(--color-secondary);
  transform: scale(1.1);
}

/* ***********************************************
   20. Stock de Producto - style.html - V1.02-SV01
   *********************************************** */

.producto-stock {
  font-size: 0.85rem;
  color: var(--color-text-muted);
  margin-top: var(--spacing-xs);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.producto-stock::before {
  content: 'üì¶';
  font-size: 0.9rem;
}

/* ***********************************************
   21. Control de Cantidad - style.html - V1.02-SV01
   *********************************************** */

.producto-cantidad-control {
  margin-top: var(--spacing-md);
  padding-top: var(--spacing-md);
  border-top: 1px solid var(--color-accent);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.producto-cantidad-control label {
  font-size: 0.85rem;
  color: var(--color-text-muted);
  font-weight: 500;
}

.cantidad-input-group {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  justify-content: center;
}

.btn-cantidad {
  background-color: var(--color-accent);
  border: 1px solid var(--color-primary);
  color: var(--color-primary);
  width: 32px;
  height: 32px;
  border-radius: var(--border-radius-sm);
  font-size: 1.2rem;
  font-weight: bold;
  cursor: pointer;
  transition: all var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

.btn-cantidad:hover {
  background-color: var(--color-primary);
  color: var(--color-secondary);
  transform: scale(1.1);
}

.btn-cantidad:active {
  transform: scale(0.95);
}

.cantidad-input {
  width: 60px;
  text-align: center;
  background-color: var(--color-background);
  border: 1px solid var(--color-accent);
  border-radius: var(--border-radius-sm);
  color: var(--color-primary);
  font-size: 1rem;
  font-weight: 600;
  padding: var(--spacing-xs);
}

/* ***********************************************
   22. Badges de Estado - style.html - V1.02-SV01
   *********************************************** */

.pedido-estado-badge {
  padding: var(--spacing-xs) var(--spacing-md);
  border-radius: var(--border-radius-sm);
  font-size: 0.8rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.badge-pendiente {
  background-color: rgba(255, 152, 0, 0.2);
  color: var(--color-warning);
  border: 1px solid var(--color-warning);
}

.badge-pagado {
  background-color: rgba(76, 175, 80, 0.2);
  color: var(--color-success);
  border: 1px solid var(--color-success);
}

/* ***********************************************
   23. Tel√©fono en Pedido - style.html - V1.02-SV01
   *********************************************** */

.pedido-cliente-info {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.pedido-telefono {
  font-size: 0.9rem;
  color: var(--color-text-muted);
}

/* ***********************************************
   24. Badge de Cantidad en Productos - style.html - V1.02-SV01
   *********************************************** */

.producto-cantidad-badge {
  display: inline-block;
  background-color: var(--color-accent);
  color: var(--color-primary);
  padding: 2px 8px;
  border-radius: var(--border-radius-sm);
  font-size: 0.85rem;
  font-weight: 600;
  margin-left: var(--spacing-xs);
}

/* ***********************************************
   25. Bot√≥n Marcar Pagado - style.html - V1.02-SV01
   *********************************************** */

.btn-marcar-pagado {
  width: 100%;
  margin-top: var(--spacing-md);
  padding: var(--spacing-md);
  background-color: var(--color-success);
  color: white;
  border: none;
  border-radius: var(--border-radius-md);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-normal);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.btn-marcar-pagado:hover {
  background-color: #45a049;
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-marcar-pagado:active {
  transform: translateY(0);
}

/* ***********************************************
   26. Pedido Pagado - style.html - V1.02-SV01
   *********************************************** */

.pedido-pagado {
  opacity: 0.85;
  border-color: var(--color-success);
}

.pedido-pagado .pedido-header-info {
  background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, transparent 100%);
}

/* ***********************************************
   27. Pesta√±as de Pedidos - style.html - V1.04-SV01
   *********************************************** */

.pedidos-tabs {
  display: flex;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
  padding: 0 var(--spacing-md);
  border-bottom: 2px solid var(--color-accent);
}

.tab-button {
  flex: 1;
  padding: var(--spacing-md) var(--spacing-lg);
  background-color: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  color: var(--color-text-muted);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-normal);
  text-align: center;
  position: relative;
  bottom: -2px;
}

.tab-button:hover {
  color: var(--color-primary);
  background-color: rgba(212, 175, 55, 0.05);
}

.tab-button.active {
  color: var(--color-primary);
  border-bottom-color: var(--color-primary);
  background-color: rgba(212, 175, 55, 0.1);
}

.tab-button.active::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-bottom: 6px solid var(--color-primary);
}

/* Responsividad de pesta√±as */
@media (max-width: 767px) {
  .tab-button {
    font-size: 0.9rem;
    padding: var(--spacing-sm) var(--spacing-md);
  }
}

/* ***********************************************
   28. Bot√≥n Foto de Producto - style.html - V1.08-SV01
   *********************************************** */

.btn-foto {
  position: absolute;
  top: var(--spacing-sm);
  left: var(--spacing-sm);
  background-color: var(--color-accent);
  border: 1px solid var(--color-primary);
  color: var(--color-primary);
  padding: 4px 8px;
  border-radius: var(--border-radius-sm);
  font-size: 0.75rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-fast);
  z-index: 3;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.btn-foto:hover {
  background-color: var(--color-primary);
  color: var(--color-secondary);
  transform: scale(1.05);
}

.btn-foto:active {
  transform: scale(0.95);
}

/* ***********************************************
   29. Modal de Imagen - style.html - V1.08-SV01
   *********************************************** */

.modal-imagen {
  max-width: 800px;
}

.modal-imagen-body {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-lg);
  min-height: 300px;
  background-color: var(--color-background);
}

.imagen-producto-modal {
  max-width: 100%;
  max-height: 70vh;
  object-fit: contain;
  border-radius: var(--border-radius-md);
  box-shadow: var(--shadow-lg);
}

/* Responsividad del modal de imagen */
@media (max-width: 767px) {
  .modal-imagen {
    max-width: 95vw;
  }
  
  .modal-imagen-body {
    padding: var(--spacing-md);
    min-height: 200px;
  }
  
  .imagen-producto-modal {
    max-height: 60vh;
  }
}

/* ***********************************************
   30. Bot√≥n Ver Foto - style.html - V1.10-SV01
   *********************************************** */

.btn-ver-foto {
  position: absolute;
  bottom: var(--spacing-sm);
  right: var(--spacing-sm);
  background-color: var(--color-accent);
  border: 1px solid var(--color-primary);
  color: var(--color-primary);
  padding: 4px 8px;
  border-radius: var(--border-radius-sm);
  font-size: 0.7rem;
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  transition: all var(--transition-fast);
  z-index: 3;
  display: inline-block;
}

.btn-ver-foto:hover {
  background-color: var(--color-primary);
  color: var(--color-secondary);
  transform: scale(1.05);
  text-decoration: none;
}

.btn-ver-foto:active {
  transform: scale(0.95);
}

</style>


// ============================================
// ARCHIVO 7/7: testall.gs
// URL: https://raw.githubusercontent.com/koki81pe/Bebidas/refs/heads/main/testall.gs
// ============================================

/*
***********************************************
Bebidas a Pedido - testall.gs - V1.03
23/12/2024 - 15:10
***********************************************
*/

// ***********************************************
// 01. Funci√≥n Principal de Testing - testall.gs - V1.01-SV01
// ***********************************************

function testAll() {
  console.log('='.repeat(60));
  console.log('INICIANDO BATER√çA COMPLETA DE PRUEBAS - BEBIDAS A PEDIDO');
  console.log('='.repeat(60));
  console.log('');
  
  const resultados = {
    total: 0,
    exitosos: 0,
    fallidos: 0,
    tests: []
  };
  
  // Ejecutar todas las pruebas
  ejecutarTest(resultados, 'Autorizaci√≥n Inicial', testAutorizacion);
  ejecutarTest(resultados, 'Conexi√≥n al Sheet', testConexionSheet);
  ejecutarTest(resultados, 'Lectura de Licores', testLeerLicores);
  ejecutarTest(resultados, 'Verificaci√≥n de Admin', testVerificarAdmin);
  ejecutarTest(resultados, 'Generaci√≥n de ID Pedido', testGenerarIdPedido);
  ejecutarTest(resultados, 'Guardado de Pedido', testGuardarPedido);
  ejecutarTest(resultados, 'Lectura de Pedidos', testLeerPedidos);
  ejecutarTest(resultados, 'Marcar Pagado', testMarcarPagado);
  
  // Mostrar resumen
  console.log('');
  console.log('='.repeat(60));
  console.log('RESUMEN DE PRUEBAS');
  console.log('='.repeat(60));
  console.log(`Total de pruebas: ${resultados.total}`);
  console.log(`Exitosas: ${resultados.exitosos} ‚úì`);
  console.log(`Fallidas: ${resultados.fallidos} ‚úó`);
  console.log('');
  
  resultados.tests.forEach(test => {
    const icono = test.exito ? '‚úì' : '‚úó';
    console.log(`${icono} ${test.nombre}: ${test.mensaje}`);
  });
  
  console.log('');
  console.log('='.repeat(60));
  
  if (resultados.fallidos === 0) {
    console.log('¬°TODAS LAS PRUEBAS PASARON EXITOSAMENTE! üéâ');
  } else {
    console.log('ALGUNAS PRUEBAS FALLARON. REVISA LOS DETALLES ARRIBA. ‚ö†Ô∏è');
  }
  console.log('='.repeat(60));
  
  return resultados;
}

// ***********************************************
// 02. Funci√≥n Ejecutar Test - testall.gs - V1.01-SV01
// ***********************************************

function ejecutarTest(resultados, nombreTest, funcionTest) {
  resultados.total++;
  console.log(`\n‚ñ∂ Ejecutando: ${nombreTest}...`);
  console.log('-'.repeat(60));
  
  try {
    const resultado = funcionTest();
    
    if (resultado.success) {
      resultados.exitosos++;
      resultados.tests.push({
        nombre: nombreTest,
        exito: true,
        mensaje: resultado.mensaje || 'OK'
      });
      console.log(`‚úì ${nombreTest}: EXITOSO`);
      if (resultado.detalles) {
        console.log(`  Detalles: ${resultado.detalles}`);
      }
    } else {
      resultados.fallidos++;
      resultados.tests.push({
        nombre: nombreTest,
        exito: false,
        mensaje: resultado.mensaje || 'Error desconocido'
      });
      console.log(`‚úó ${nombreTest}: FALLIDO`);
      console.log(`  Error: ${resultado.mensaje}`);
    }
  } catch (error) {
    resultados.fallidos++;
    resultados.tests.push({
      nombre: nombreTest,
      exito: false,
      mensaje: error.toString()
    });
    console.log(`‚úó ${nombreTest}: EXCEPCI√ìN`);
    console.log(`  Error: ${error.toString()}`);
  }
}

// ***********************************************
// 03. Test: Autorizaci√≥n Inicial - testall.gs - V1.01-SV01
// ***********************************************

function testAutorizacion() {
  try {
    // Forzar autorizaci√≥n accediendo a servicios que requieren permisos
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const nombre = ss.getName();
    
    return {
      success: true,
      mensaje: 'Autorizaci√≥n concedida',
      detalles: `Sheet: "${nombre}"`
    };
  } catch (error) {
    return {
      success: false,
      mensaje: `Error de autorizaci√≥n: ${error.toString()}`
    };
  }
}

// ***********************************************
// 04. Test: Conexi√≥n al Sheet - testall.gs - V1.01-SV01
// ***********************************************

function testConexionSheet() {
  try {
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const hojas = ss.getSheets().map(h => h.getName());
    
    // Verificar que existan las hojas necesarias
    const hojasRequeridas = [SHEET_LICORES, SHEET_PEDIDOS, SHEET_ADMIN];
    const hojasFaltantes = hojasRequeridas.filter(h => !hojas.includes(h));
    
    if (hojasFaltantes.length > 0) {
      return {
        success: false,
        mensaje: `Faltan hojas: ${hojasFaltantes.join(', ')}`
      };
    }
    
    return {
      success: true,
      mensaje: 'Conexi√≥n exitosa',
      detalles: `Hojas encontradas: ${hojas.join(', ')}`
    };
  } catch (error) {
    return {
      success: false,
      mensaje: `Error de conexi√≥n: ${error.toString()}`
    };
  }
}

// ***********************************************
// 05. Test: Lectura de Licores - testall.gs - V1.01-SV01
// ***********************************************

function testLeerLicores() {
  try {
    const resultado = getLicores();
    
    if (!resultado.success) {
      return {
        success: false,
        mensaje: resultado.message
      };
    }
    
    const licores = resultado.data;
    
    if (!Array.isArray(licores)) {
      return {
        success: false,
        mensaje: 'El resultado no es un array'
      };
    }
    
    if (licores.length === 0) {
      return {
        success: false,
        mensaje: 'No se encontraron licores en la hoja'
      };
    }
    
    // Verificar estructura del primer licor
    const primer = licores[0];
    const camposRequeridos = ['code', 'producto', 'empaque', 'size', 'precio'];
    const camposFaltantes = camposRequeridos.filter(campo => !(campo in primer));
    
    if (camposFaltantes.length > 0) {
      return {
        success: false,
        mensaje: `Faltan campos: ${camposFaltantes.join(', ')}`
      };
    }
    
    return {
      success: true,
      mensaje: 'Lectura exitosa',
      detalles: `${licores.length} licores encontrados. Ejemplo: ${primer.producto}`
    };
  } catch (error) {
    return {
      success: false,
      mensaje: `Error: ${error.toString()}`
    };
  }
}

// ***********************************************
// 06. Test: Verificaci√≥n de Admin - testall.gs - V1.01-SV01
// ***********************************************

function testVerificarAdmin() {
  try {
    // Obtener el primer usuario admin de la hoja
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sheet = ss.getSheetByName(SHEET_ADMIN);
    const data = sheet.getDataRange().getValues();
    
    if (data.length < 2) {
      return {
        success: false,
        mensaje: 'No hay usuarios en la hoja Admin'
      };
    }
    
    const usuarioTest = data[1][0]; // Primer usuario
    
    // Probar verificaci√≥n exitosa
    const resultadoOK = verificarAcceso(usuarioTest);
    if (!resultadoOK.success) {
      return {
        success: false,
        mensaje: `Verificaci√≥n fallida para usuario v√°lido: ${usuarioTest}`
      };
    }
    
    // Probar verificaci√≥n fallida
    const resultadoFail = verificarAcceso('usuario_inexistente_12345');
    if (resultadoFail.success) {
      return {
        success: false,
        mensaje: 'Verificaci√≥n permiti√≥ usuario inv√°lido'
      };
    }
    
    return {
      success: true,
      mensaje: 'Verificaci√≥n funciona correctamente',
      detalles: `Usuario v√°lido probado: ${usuarioTest}`
    };
  } catch (error) {
    return {
      success: false,
      mensaje: `Error: ${error.toString()}`
    };
  }
}

// ***********************************************
// 07. Test: Generaci√≥n de ID Pedido - testall.gs - V1.01-SV01
// ***********************************************

function testGenerarIdPedido() {
  try {
    const pedidoId = generarIdPedido();
    
    // Verificar formato PED-YYYYMMDD-###
    const patron = /^PED-\d{8}-\d{3}$/;
    
    if (!patron.test(pedidoId)) {
      return {
        success: false,
        mensaje: `Formato incorrecto: ${pedidoId}. Esperado: PED-YYYYMMDD-###`
      };
    }
    
    // Verificar que la fecha sea de hoy
    const hoy = Utilities.formatDate(new Date(), 'America/Lima', 'yyyyMMdd');
    if (!pedidoId.includes(hoy)) {
      return {
        success: false,
        mensaje: `La fecha no corresponde al d√≠a actual. ID: ${pedidoId}`
      };
    }
    
    return {
      success: true,
      mensaje: 'Generaci√≥n exitosa',
      detalles: `ID generado: ${pedidoId}`
    };
  } catch (error) {
    return {
      success: false,
      mensaje: `Error: ${error.toString()}`
    };
  }
}

// ***********************************************
// 08. Test: Guardado de Pedido - testall.gs - V1.03-SV01
// ***********************************************

function testGuardarPedido() {
  try {
    // Crear pedido de prueba con c√≥digo conocido
    const codigoTest = 'TEST001';
    const productosTest = [
      {
        code: codigoTest,
        producto: 'Licor Test 1',
        empaque: 'Botella',
        size: '750ml',
        precio: 50.00,
        cantidad: 3  // Pedir 3 unidades
      }
    ];
    
    const clienteTest = 'Cliente Test - ' + new Date().getTime();
    const telefonoTest = '999888777';
    
    // Obtener CantReq ANTES de guardar (si existe el producto TEST001)
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sheetLicores = ss.getSheetByName(SHEET_LICORES);
    const dataLicores = sheetLicores.getDataRange().getValues();
    
    let cantReqAntes = null;
    let filaProducto = -1;
    for (let i = 1; i < dataLicores.length; i++) {
      if (dataLicores[i][0] === codigoTest) {
        filaProducto = i + 1;
        cantReqAntes = parseInt(dataLicores[i][7]) || 0; // Col H
        break;
      }
    }
    
    // Guardar pedido
    const resultado = guardarPedido(clienteTest, telefonoTest, productosTest);
    
    if (!resultado.success) {
      return {
        success: false,
        mensaje: resultado.message
      };
    }
    
    // Verificar que se haya guardado en Pedidos
    const sheetPedidos = ss.getSheetByName(SHEET_PEDIDOS);
    const dataPedidos = sheetPedidos.getDataRange().getValues();
    
    const pedidoEncontrado = dataPedidos.slice(1).some(row => 
      row[9] === resultado.pedidoId // Columna J: Pedido
    );
    
    if (!pedidoEncontrado) {
      return {
        success: false,
        mensaje: 'El pedido no se encontr√≥ en la hoja despu√©s de guardarlo'
      };
    }
    
    // Verificar que CantReq se haya actualizado (solo si el producto existe)
    if (filaProducto !== -1 && cantReqAntes !== null) {
      const dataLicoresActualizada = sheetLicores.getDataRange().getValues();
      const cantReqDespues = parseInt(dataLicoresActualizada[filaProducto - 1][7]) || 0;
      
      if (cantReqDespues !== cantReqAntes + 3) {
        return {
          success: false,
          mensaje: `CantReq no se actualiz√≥ correctamente. Antes: ${cantReqAntes}, Despu√©s: ${cantReqDespues}, Esperado: ${cantReqAntes + 3}`
        };
      }
    }
    
    return {
      success: true,
      mensaje: 'Guardado exitoso',
      detalles: `Pedido: ${resultado.pedidoId}, Cliente: ${clienteTest}, Tel: ${telefonoTest}, Productos: ${productosTest.length}${filaProducto !== -1 ? ', CantReq actualizada correctamente' : ''}`
    };
  } catch (error) {
    return {
      success: false,
      mensaje: `Error: ${error.toString()}`
    };
  }
}

// ***********************************************
// 09. Test: Lectura de Pedidos - testall.gs - V1.02-SV01
// ***********************************************

function testLeerPedidos() {
  try {
    const resultado = getPedidos();
    
    if (!resultado.success) {
      return {
        success: false,
        mensaje: resultado.message
      };
    }
    
    const pedidos = resultado.data;
    
    if (!Array.isArray(pedidos)) {
      return {
        success: false,
        mensaje: 'El resultado no es un array'
      };
    }
    
    // Si hay pedidos, verificar estructura
    if (pedidos.length > 0) {
      const primer = pedidos[0];
      const camposRequeridos = ['pedidoId', 'cliente', 'telefono', 'fecha', 'estado', 'productos', 'total'];
      const camposFaltantes = camposRequeridos.filter(campo => !(campo in primer));
      
      if (camposFaltantes.length > 0) {
        return {
          success: false,
          mensaje: `Faltan campos: ${camposFaltantes.join(', ')}`
        };
      }
      
      // Verificar que productos sea un array
      if (!Array.isArray(primer.productos)) {
        return {
          success: false,
          mensaje: 'El campo productos no es un array'
        };
      }
      
      // Verificar que productos tengan cantidad
      if (primer.productos.length > 0 && !('cantidad' in primer.productos[0])) {
        return {
          success: false,
          mensaje: 'Los productos no tienen campo cantidad'
        };
      }
    }
    
    return {
      success: true,
      mensaje: 'Lectura exitosa',
      detalles: `${pedidos.length} pedidos encontrados`
    };
  } catch (error) {
    return {
      success: false,
      mensaje: `Error: ${error.toString()}`
    };
  }
}

// ***********************************************
// 10. Test: Marcar Pagado - testall.gs - V1.03-SV01
// ***********************************************

function testMarcarPagado() {
  try {
    const codigoTest = 'TEST001';
    
    // Primero crear un pedido de prueba
    const productosTest = [
      {
        code: codigoTest,
        producto: 'Licor Test Pago',
        empaque: 'Botella',
        size: '750ml',
        precio: 50.00,
        cantidad: 2
      }
    ];
    
    const clienteTest = 'Cliente Test Pago - ' + new Date().getTime();
    const telefonoTest = '999888777';
    
    // Obtener valores ANTES en Licores (si existe el producto)
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sheetLicores = ss.getSheetByName(SHEET_LICORES);
    const dataLicoresAntes = sheetLicores.getDataRange().getValues();
    
    let cantReqAntes = null;
    let cantVendidaAntes = null;
    let filaProducto = -1;
    
    for (let i = 1; i < dataLicoresAntes.length; i++) {
      if (dataLicoresAntes[i][0] === codigoTest) {
        filaProducto = i + 1;
        cantReqAntes = parseInt(dataLicoresAntes[i][7]) || 0; // Col H
        cantVendidaAntes = parseInt(dataLicoresAntes[i][8]) || 0; // Col I
        break;
      }
    }
    
    // Guardar pedido
    const resultadoPedido = guardarPedido(clienteTest, telefonoTest, productosTest);
    
    if (!resultadoPedido.success) {
      return {
        success: false,
        mensaje: 'No se pudo crear pedido de prueba: ' + resultadoPedido.message
      };
    }
    
    const pedidoId = resultadoPedido.pedidoId;
    
    // Obtener CantReq DESPU√âS de crear pedido
    const dataLicoresDespuesPedido = sheetLicores.getDataRange().getValues();
    let cantReqDespuesPedido = null;
    if (filaProducto !== -1) {
      cantReqDespuesPedido = parseInt(dataLicoresDespuesPedido[filaProducto - 1][7]) || 0;
    }
    
    // Marcar como pagado
    const resultadoPagado = marcarPagado(pedidoId);
    
    if (!resultadoPagado.success) {
      return {
        success: false,
        mensaje: 'Error al marcar pagado: ' + resultadoPagado.message
      };
    }
    
    // Verificar que el estado cambi√≥ a "Pagado"
    const sheetPedidos = ss.getSheetByName(SHEET_PEDIDOS);
    const dataPedidos = sheetPedidos.getDataRange().getValues();
    
    const pedidoEncontrado = dataPedidos.slice(1).find(row => row[9] === pedidoId); // Col J: Pedido
    
    if (!pedidoEncontrado) {
      return {
        success: false,
        mensaje: 'No se encontr√≥ el pedido despu√©s de marcarlo'
      };
    }
    
    if (pedidoEncontrado[10] !== 'Pagado') { // Col K: Estado
      return {
        success: false,
        mensaje: `Estado incorrecto: ${pedidoEncontrado[10]}, esperado: Pagado`
      };
    }
    
    // Verificar actualizaci√≥n de CantReq y CantVendida (solo si el producto existe)
    if (filaProducto !== -1 && cantReqAntes !== null && cantVendidaAntes !== null) {
      const dataLicoresDespuesPago = sheetLicores.getDataRange().getValues();
      const cantReqDespues = parseInt(dataLicoresDespuesPago[filaProducto - 1][7]) || 0;
      const cantVendidaDespues = parseInt(dataLicoresDespuesPago[filaProducto - 1][8]) || 0;
      
      // CantReq deber√≠a haber bajado en 2
      if (cantReqDespues !== cantReqDespuesPedido - 2) {
        return {
          success: false,
          mensaje: `CantReq no se actualiz√≥. Antes Pago: ${cantReqDespuesPedido}, Despu√©s: ${cantReqDespues}, Esperado: ${cantReqDespuesPedido - 2}`
        };
      }
      
      // CantVendida deber√≠a haber subido en 2
      if (cantVendidaDespues !== cantVendidaAntes + 2) {
        return {
          success: false,
          mensaje: `CantVendida no se actualiz√≥. Antes: ${cantVendidaAntes}, Despu√©s: ${cantVendidaDespues}, Esperado: ${cantVendidaAntes + 2}`
        };
      }
    }
    
    return {
      success: true,
      mensaje: 'Marcar pagado funciona correctamente',
      detalles: `Pedido ${pedidoId} marcado como Pagado${filaProducto !== -1 ? ', CantReq y CantVendida actualizadas correctamente' : ''}`
    };
  } catch (error) {
    return {
      success: false,
      mensaje: `Error: ${error.toString()}`
    };
  }
}

// ***********************************************
// 11. Funci√≥n para Forzar Autorizaci√≥n - testall.gs - V1.02-SV01
// ***********************************************

function forceAuthorization() {
  console.log('Forzando autorizaci√≥n de permisos...');
  console.log('');
  
  try {
    // Acceder a SpreadsheetApp
    const ss = SpreadsheetApp.openById(SHEET_ID);
    console.log('‚úì Acceso a SpreadsheetApp autorizado');
    
    // Acceder a propiedades
    const props = PropertiesService.getScriptProperties();
    console.log('‚úì Acceso a PropertiesService autorizado');
    
    // Acceder a UrlFetchApp (si se necesita en el futuro)
    console.log('‚úì Preparado para UrlFetchApp');
    
    console.log('');
    console.log('='.repeat(60));
    console.log('AUTORIZACI√ìN COMPLETADA EXITOSAMENTE');
    console.log('='.repeat(60));
    console.log('');
    console.log('Ahora puedes desplegar la aplicaci√≥n web.');
    console.log('Pasos siguientes:');
    console.log('1. Haz clic en "Implementar" > "Nueva implementaci√≥n"');
    console.log('2. Selecciona "Aplicaci√≥n web"');
    console.log('3. Ejecutar como: Tu usuario');
    console.log('4. Qui√©n tiene acceso: Cualquier usuario');
    console.log('5. Haz clic en "Implementar"');
    
    return true;
  } catch (error) {
    console.error('‚úó Error durante la autorizaci√≥n: ' + error.toString());
    return false;
  }
}


// ============================================
// FIN DEL SOLID CODE
// Tama√±o total: 107,996 caracteres
// Archivos exitosos: 7/7
// ============================================
